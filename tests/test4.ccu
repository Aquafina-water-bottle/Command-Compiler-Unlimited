// Capture the Flag

DEF activate setblock |0| redstone_block 0
DEF deactivate setblock |0| stonebrick 0

// Spawn Area
DEF $SA$ x=548,y=106,z=148,dx=20,dy=5,dz=21
DEF $ArenaArea$ x=535,y=0,z=129,dx=50,dy=256,dz=64

DEF COORDS $CoordsOption$ 544 48 144
DEF $StyleDirection$ +X
DEF $SPid$ 33
DEF $SPpvp$ 1
DEF $SPsat$ 0

DEF $CMDName$ CTF
DEF $CMDSizeX$ 16
DEF $CMDSizeY$ 16
DEF $CMDSizeZ$ 16

ARRAY {Team_Red}:
	CTFRed Red Team
	OPT color red
	OPT friendlyFire false
	
ARRAY {Team_Blue}:
	CTFBlue Blue Team
	OPT color Blue
	OPT friendlyFire false

// ARRAY {TELE Arr_RedSpawnPoints}:
// ARRAY {TELE Arr_BlueSpawnPoints}:

// DEF TELE $RedFlagPos$ 
// DEF TELE $BlueFlagPos$ 

DEF RedFlag ArmorStand ~ ~ ~ {Tags:["CTFRedFlag","CTFFlag"],Invulnerable:1b,NoBasePlate:1b,Small:1b,Marker:1b,ArmorItems:[{},{},{},{id:"wool",Count:1b,Damage:14}],HandItems:[{},{}],CustomName:"Red Flag",DisabledSlots:0,Glowing:1b,CustomNameVisible:1b,Invisible:1b}
DEF BlueFlag ArmorStand ~ ~ ~ {Tags:["CTFBlueFlag","CTFFlag"],Invulnerable:1b,NoBasePlate:1b,Small:1b,Marker:1b,ArmorItems:[{},{},{},{id:"wool",Count:1b,Damage:11}],HandItems:[{},{}],CustomName:"Blue Flag",DisabledSlots:0,Glowing:1b,CustomNameVisible:1b,Invisible:1b}

ARRAY {Arr_Summons}:
	AreaEffectCloud ~ ~ ~ {Duration:MAX_INT,Tags:["CTFSummon","CTFGame"]}
	AreaEffectCloud ~ ~ ~ {Duration:MAX_INT,Tags:["CTFSummon","CTFRedAoE","CTFTeamAoE"]}
	AreaEffectCloud ~ ~ ~ {Duration:MAX_INT,Tags:["CTFSummon","CTFBlueAoE","CTFTeamAoE"]}

ARRAY {Arr_ScoreboardObjectives}:
	CTFscore dummy Score
	CTFgen dummy General

IMPORT {LIBRARY GETDIR General}
DEF MAX_INT CALC(2 ^ 31 - 1)
DEF MIN_INT CALC(-2 ^ 31)

OPTIONS:
	blockOption stonebrick 0
	coordsOption $CoordsOption$
	styleOption $StyleDirection$ 16
	
	parseOption true
	commandOption true
	combinerOption true

//// EC Book ////

// GROUP {PULSE Grp_Book}:

//// Start ////

GROUP {PULSE Grp_Start}:
	
	CCU.spawnIDSetting()
	CCU.spawnStandStart()
	
	CCU.teamAdd(Team_Red)
	CCU.teamAdd(Team_Blue)
	CCU.objectiveAdd(Arr_ScoreboardObjectives)
	
	LOOP {Arr_Summons[S]}:
		summon |0|

//// Main ////

// GROUP {CLOCK Grp_Main}:

//// Assign Teams ////

GROUP {CLOCK Grp_Teams}:
	red_minus_blue_count CTFgen = red_count CTFGen
	red_minus_blue_count CTFgen - blue_count CTFGen
	
	red_minus_blue_count CTFgen ? 0 0
	COND:
		@r[$SA$,team=] + CTFJoinRandom
		
	@r[CTFTeamAoE,c=1] + CTFRandTeamAoE
	@e[CTFRandTeamAoE,team=CTFRed] J> CTFRed @a[CTFJoinRandom]
	@e[CTFRandTeamAoE,team=CTFBlue] J> CTFBlue @a[CTFJoinRandom]
	@e[CTFRandTeamAoE] - CTFRandTeamAoE
	@a[CTFJoinRandom] - CTFJoinRandom
	
	
	red_minus_blue_count CTFgen ? 1 MAX_INT
	COND:
		J> CTFBlue @r[$SA$,team=]
	
	red_minus_blue_count CTFgen ? MIN_INT -1
	COND:
		J> CTFRed @r[$SA$,team=]
	
	
	activate(GSELF)
	
	testfor @a[$SA$,team=]
	COND:
		deactivate(GSELF)

//// Stop ////

GROUP {PULSE Grp_Stop}:
	CCU.spawnStandEnd()
	
	CCU.teamRemove(Team_Red)
	CCU.teamRemove(Team_Blue)
	CCU.objectiveRemove(Arr_ScoreboardObjectives)
	
	kill @e[CTFSummon]

//// Command Save ////

CCU.cmdSave()